<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แผนการจัดการเรียนรู้ดิจิทัล: กฎการอนุรักษ์พลังงานกล</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- SweetAlert2 (Popup สวยๆ) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; }
        h1, h2, h3, h4, h5, h6, .font-prompt { font-family: 'Prompt', sans-serif; }
        .math-display { overflow-x: auto; overflow-y: hidden; }
        /* Removed conflicting iframe height CSS to fix PhET display */
    </style>
</head>
<body class="text-gray-800 pb-20">

    <!-- Navbar -->
    <nav class="bg-indigo-800 text-white p-4 shadow-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-atom text-2xl text-yellow-400"></i>
                <div>
                    <span class="font-bold text-lg font-prompt block leading-tight">Digital Lesson Plan</span>
                    <span class="text-xs text-indigo-200">Active Learning & Technology Integration</span>
                </div>
            </div>
            <!-- ปุ่มตั้งค่าถูกลบออกตามคำขอ -->
        </div>
    </nav>

    <div class="container mx-auto max-w-5xl p-4 md:p-8 my-6 bg-white shadow-xl rounded-xl border border-gray-200">
        
        <!-- Header: School & Teacher Info -->
        <header class="border-b-4 border-indigo-600 pb-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start gap-6">
                <div class="flex-1">
                    <h5 class="text-indigo-600 font-bold uppercase tracking-wide text-sm mb-1">กลุ่มสาระการเรียนรู้วิทยาศาสตร์และเทคโนโลยี</h5>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 font-prompt">โรงเรียนห้องสอนศึกษาในพระอุปถัมภ์ฯ</h1>
                    <div class="mt-4 space-y-1">
                        <h2 class="text-2xl font-bold text-gray-800">เรื่อง กฎการอนุรักษ์พลังงานกล</h2>
                        <h3 class="text-lg text-gray-500 font-light">(Law of Conservation of Mechanical Energy)</h3>
                    </div>
                </div>
                
                <div class="bg-indigo-50 p-5 rounded-xl border border-indigo-100 min-w-[280px] shadow-sm">
                    <div class="flex items-center gap-3 mb-2 border-b border-indigo-200 pb-2">
                        <div class="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center"><i class="fa-solid fa-user-tie"></i></div>
                        <div>
                            <p class="text-xs text-gray-500">ครูผู้สอน</p>
                            <p class="font-bold text-indigo-900">นายสาธิต ศิริวัชน์</p>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-700">
                        <p class="flex justify-between"><span><i class="fa-solid fa-book mr-2 text-indigo-400"></i>วิชา:</span> <span class="font-bold">ฟิสิกส์ 2 (ว31201)</span></p>
                        <p class="flex justify-between"><span><i class="fa-solid fa-layer-group mr-2 text-indigo-400"></i>ชั้น:</span> <span class="font-bold">มัธยมศึกษาปีที่ 4</span></p>
                        <p class="flex justify-between"><span><i class="fa-regular fa-clock mr-2 text-indigo-400"></i>เวลา:</span> <span class="font-bold">2 คาบ (100 นาที)</span></p>
                    </div>
                </div>
            </div>

            <!-- Innovation Link -->
            <div class="mt-6 p-4 bg-gradient-to-r from-cyan-600 to-blue-700 rounded-lg text-white shadow-lg flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-4">
                    <div class="bg-white/20 p-3 rounded-full backdrop-blur-sm">
                        <i class="fa-solid fa-laptop-code text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg font-prompt">สื่อการสอนนวัตกรรม (Web Application)</h3>
                        <p class="text-blue-100 text-sm">QuizPhysicsM4.2 - Conservation Of Energy</p>
                    </div>
                </div>
                <a href="https://coolnut-academy.github.io/QuizPhysicsM4.2-ConservationOfEnergy/" target="_blank" class="bg-white text-blue-700 px-6 py-2 rounded-full font-bold hover:bg-blue-50 transition shadow-md transform hover:scale-105">
                    <i class="fa-solid fa-play mr-2"></i> เปิดใช้งาน App
                </a>
            </div>
        </header>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: Info & Standards -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Learning Outcomes -->
                <div class="bg-orange-50 p-5 rounded-lg border-l-4 border-orange-500 shadow-sm">
                    <h3 class="font-bold text-lg text-orange-800 mb-3 font-prompt">
                        <i class="fa-solid fa-scroll mr-2"></i> ผลการเรียนรู้
                    </h3>
                    <p class="text-sm text-gray-700 leading-relaxed text-justify">
                        "วิเคราะห์และคำนวณงานของแรงลัพธ์และกำลัง อธิบายและคำนวณพลังงานจลน์ พลังงานศักย์ พลังงานกล... <b>นำความรู้เรื่องพลังงานกลและกฎการอนุรักษ์พลังงานกลไปใช้อธิบายและแก้ปัญหาในชีวิตประจำวัน</b>"
                    </p>
                </div>

                <!-- Concept & Equations -->
                <div class="bg-white p-5 rounded-lg border border-gray-200 shadow-sm">
                    <h3 class="font-bold text-lg text-gray-800 mb-3 font-prompt flex items-center">
                        <i class="fa-solid fa-square-root-variable text-purple-600 mr-2"></i> สมการหลัก
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-gray-50 p-3 rounded text-center border border-gray-200">
                            <span class="text-xs text-gray-500 block mb-1">กฎการอนุรักษ์พลังงานกล</span>
                            <div class="math-display">$$ \Sigma E_1 = \Sigma E_2 $$</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded text-center border border-gray-200">
                            <span class="text-xs text-gray-500 block mb-1">สมการฉบับเต็ม</span>
                            <div class="math-display text-xs">
                                $$ \frac{1}{2}mv_1^2 + mgh_1 + \frac{1}{2}kx_1^2 = \frac{1}{2}mv_2^2 + mgh_2 + \frac{1}{2}kx_2^2 $$
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Objectives -->
                <div class="bg-blue-50 p-5 rounded-lg border border-blue-100">
                    <h3 class="font-bold text-lg text-blue-900 mb-3 font-prompt">
                        <i class="fa-solid fa-bullseye mr-2"></i> จุดประสงค์ (KPA)
                    </h3>
                    <ul class="space-y-3 text-sm">
                        <li class="flex gap-2">
                            <span class="badge bg-blue-200 text-blue-800 px-2 rounded font-bold">K</span>
                            <span>เลือกใช้สมการวิเคราะห์โจทย์ได้ถูกต้อง</span>
                        </li>
                        <li class="flex gap-2">
                            <span class="badge bg-green-200 text-green-800 px-2 rounded font-bold">P</span>
                            <span>ใช้ Web App แก้โจทย์ได้เร็วและแม่นยำ</span>
                        </li>
                        <li class="flex gap-2">
                            <span class="badge bg-red-200 text-red-800 px-2 rounded font-bold">A</span>
                            <span>มีความซื่อสัตย์และช่วยเหลือเพื่อนในกลุ่ม</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Right Column: 5E Process -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl border border-gray-200 shadow-lg overflow-hidden">
                    <div class="bg-gray-50 p-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="font-bold text-xl text-indigo-700 font-prompt">
                            <i class="fa-solid fa-chalkboard-teacher mr-2"></i> กิจกรรมการเรียนรู้ (5E + STAD)
                        </h3>
                    </div>

                    <div class="p-6 space-y-6">
                        
                        <!-- Step 1 -->
                        <div class="relative pl-8 border-l-2 border-indigo-200">
                            <div class="absolute -left-[17px] top-0 bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">1</div>
                            <h4 class="font-bold text-gray-800 font-prompt text-lg">ขั้นสร้างความสนใจ (Engagement) <span class="text-xs bg-gray-200 px-2 py-1 rounded ml-2 text-gray-600">10 นาที</span></h4>
                            <div class="mt-2 text-gray-600 text-sm space-y-2">
                                <p>• <b>Stimulus:</b> ครูเปิดคลิป Roller Coaster ให้เห็นกราฟแท่งพลังงานที่เปลี่ยนไปมา</p>
                                <p>• <b>Question:</b> "ทำไมรถไฟเหาะถึงวิ่งกลับมาจุดเดิมไม่ได้ถ้ามีความเสียดทาน?"</p>
                            </div>
                        </div>

                        <!-- Step 2 -->
                        <div class="relative pl-8 border-l-2 border-indigo-200">
                            <div class="absolute -left-[17px] top-0 bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">2</div>
                            <h4 class="font-bold text-gray-800 font-prompt text-lg">ขั้นสำรวจและค้นหา (Exploration) <span class="text-xs bg-gray-200 px-2 py-1 rounded ml-2 text-gray-600">30 นาที</span></h4>
                            <div class="mt-2 text-gray-600 text-sm space-y-2">
                                <span class="inline-block bg-pink-100 text-pink-700 text-xs px-2 py-1 rounded font-bold mb-1">STAD Phase: Team Study</span>
                                <p>• แบ่งกลุ่มคละความสามารถ (4 คน) เข้าเมนู <b>"สอบควิซกลุ่ม"</b></p>
                                <p>• สมาชิกช่วยกันระดมสมองหาคำตอบจากโจทย์ที่สุ่มขึ้นมา (เพื่อนเก่งสอนเพื่อนอ่อน)</p>
                                <p>• แข่งขันความเร็วเพื่อชิงคะแนนลำดับ (Gamification)</p>
                            </div>
                        </div>

                        <!-- Step 3: Explanation + PhET Sim -->
                        <div class="relative pl-8 border-l-2 border-indigo-200">
                            <div class="absolute -left-[17px] top-0 bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">3</div>
                            <h4 class="font-bold text-gray-800 font-prompt text-lg">ขั้นอธิบายและลงข้อสรุป (Explanation) <span class="text-xs bg-gray-200 px-2 py-1 rounded ml-2 text-gray-600">20 นาที</span></h4>
                            
                            <div class="mt-3 mb-4">
                                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3">
                                    <p class="text-sm font-bold text-indigo-800 mb-2"><i class="fa-solid fa-vr-cardboard mr-2"></i>สื่อประกอบ: PhET Simulation (Energy Skate Park)</p>
                                    <p class="text-xs text-gray-600 mb-2">ใช้ Simulation นี้อธิบายความสัมพันธ์กราฟพลังงานจลน์และศักย์</p>
                                    <!-- Fixed PhET Display using aspect ratio helper -->
                                    <div class="relative w-full aspect-video rounded-lg overflow-hidden shadow-sm bg-black">
                                        <iframe 
                                            src="https://phet.colorado.edu/sims/html/energy-skate-park-basics/latest/energy-skate-park-basics_en.html" 
                                            class="absolute top-0 left-0 w-full h-full border-0" 
                                            allow="fullscreen; accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen>
                                        </iframe>
                                    </div>
                                </div>
                            </div>

                            <div class="text-gray-600 text-sm space-y-2">
                                <p>• ครูดึงโจทย์ยากมาอภิปรายและใช้ PhET Sim จำลองสถานการณ์ให้เห็นภาพ</p>
                                <p>• สรุป Concept: \( \Sigma E_{before} = \Sigma E_{after} \)</p>
                            </div>
                        </div>

                        <!-- Step 4 -->
                        <div class="relative pl-8 border-l-2 border-indigo-200">
                            <div class="absolute -left-[17px] top-0 bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">4</div>
                            <h4 class="font-bold text-gray-800 font-prompt text-lg">ขั้นขยายความรู้ (Elaboration) <span class="text-xs bg-gray-200 px-2 py-1 rounded ml-2 text-gray-600">30 นาที</span></h4>
                            <div class="mt-2 text-gray-600 text-sm space-y-2">
                                <span class="inline-block bg-pink-100 text-pink-700 text-xs px-2 py-1 rounded font-bold mb-1">STAD Phase: Solo Quiz</span>
                                <p>• นักเรียนทำ <b>"สอบควิซเดี่ยว"</b> (ระบุเลขที่ยืนยันตัวตน)</p>
                                <p>• โจทย์แต่ละคนไม่เหมือนกัน (Randomized) ต้องทำด้วยตนเอง</p>
                                <p>• แคปหน้าจอผลลัพธ์ส่งครู</p>
                            </div>
                        </div>

                         <!-- Step 5 -->
                         <div class="relative pl-8 border-l-2 border-indigo-200">
                            <div class="absolute -left-[17px] top-0 bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">5</div>
                            <h4 class="font-bold text-gray-800 font-prompt text-lg">ขั้นประเมินผล (Evaluation) <span class="text-xs bg-gray-200 px-2 py-1 rounded ml-2 text-gray-600">10 นาที</span></h4>
                            <div class="mt-2 text-gray-600 text-sm space-y-2">
                                <p>• สรุปคะแนนกลุ่มและมอบรางวัล (Recognition)</p>
                                <p>• <b>Bonus:</b> กลุ่มที่สมาชิกสอบผ่านทุกคน ได้คะแนนพิเศษ (+2)</p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Section 1: Post Lesson Reflection -->
        <section class="mt-8 bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-500 break-inside-avoid">
            <h3 class="font-bold text-xl text-gray-800 mb-4 font-prompt flex items-center">
                <i class="fa-solid fa-clipboard-check text-green-600 mr-2"></i> บันทึกหลังการจัดการเรียนรู้ (สำหรับครูผู้สอน)
            </h3>
            
            <form id="reflectionForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Hidden Fields for Metadata -->
                <input type="hidden" name="teacher" value="นายสาธิต ศิริวัชน์">
                <input type="hidden" name="subject" value="ฟิสิกส์ 2 (ว31201)">
                <input type="hidden" name="date" id="currentDate">

                <div class="space-y-2">
                    <label class="block text-sm font-bold text-gray-700">1. ผลสัมฤทธิ์ทางการเรียน (จำนวน ผ่าน/ไม่ผ่าน)</label>
                    <textarea name="result" id="result" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none h-32 resize-none" placeholder="เช่น นักเรียนผ่านเกณฑ์ 38 คน ไม่ผ่าน 2 คน..."></textarea>
                </div>

                <div class="space-y-2">
                    <label class="block text-sm font-bold text-gray-700">2. ปัญหาและอุปสรรค</label>
                    <textarea name="problems" id="problems" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none h-32 resize-none" placeholder="เช่น อินเทอร์เน็ตช้าในบางช่วง..."></textarea>
                </div>

                <div class="space-y-2">
                    <label class="block text-sm font-bold text-gray-700">3. ข้อเสนอแนะ / แนวทางแก้ไข</label>
                    <textarea name="suggestions" id="suggestions" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none h-32 resize-none" placeholder="เช่น ให้เพื่อนที่เน็ตแรงแชร์ Hotspot ให้เพื่อน..."></textarea>
                </div>

                <div class="space-y-2 flex flex-col justify-end">
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 text-sm text-gray-500 mb-2">
                        <i class="fa-solid fa-info-circle mr-1"></i> ข้อมูลจะถูกส่งไปยัง Google Sheets (Sheet 1: บันทึกหลังสอน)
                    </div>
                    <button type="button" onclick="submitToSheet()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow transition transform active:scale-95 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-paper-plane"></i> บันทึกข้อมูลเข้าระบบ
                    </button>
                </div>
            </form>
        </section>

        <!-- Section 2: Supervision Log (New Feature) -->
        <section class="mt-8 bg-white p-6 rounded-xl shadow-lg border-t-4 border-purple-500 break-inside-avoid mb-6">
            <h3 class="font-bold text-xl text-gray-800 mb-4 font-prompt flex items-center">
                <i class="fa-solid fa-user-check text-purple-600 mr-2"></i> บันทึกและข้อเสนอแนะจากผู้นิเทศ (Supervision Log)
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Form Input Area -->
                <div class="md:col-span-2 space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ชื่อผู้นิเทศการสอน</label>
                        <input type="text" id="supervisorName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" placeholder="ระบุชื่อ-นามสกุล">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">ตำแหน่ง</label>
                            <input type="text" id="supervisorPosition" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" placeholder="เช่น ผู้อำนวยการ / หัวหน้ากลุ่มสาระฯ">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">วิทยฐานะ</label>
                            <input type="text" id="supervisorLevel" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" placeholder="เช่น ชำนาญการพิเศษ / เชี่ยวชาญ">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">ข้อคิดเห็น / ข้อเสนอแนะเพิ่มเติม</label>
                        <textarea id="supervisorComment" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none h-32 resize-none" placeholder="ระบุข้อเสนอแนะสำหรับการปรับปรุงแผนการสอน..."></textarea>
                    </div>
                    <button type="button" onclick="submitSupervision()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg shadow transition flex items-center gap-2">
                        <i class="fa-solid fa-save"></i> บันทึกผลการนิเทศ
                    </button>
                    <p class="text-xs text-gray-400 mt-2">*ข้อมูลจะถูกส่งไปยัง Google Sheets (Sheet 2: การนิเทศ)</p>
                </div>

                <!-- Summary & Fetch Area -->
                <div class="md:col-span-1 bg-purple-50 p-4 rounded-lg border border-purple-100 flex flex-col">
                    <h4 class="font-bold text-purple-800 mb-2 border-b border-purple-200 pb-2">สรุปผลการนิเทศ</h4>
                    <div id="supervisionSummaryArea" class="flex-1 overflow-y-auto max-h-60 text-sm text-gray-600 space-y-2 mb-4">
                        <p class="text-gray-400 italic text-center mt-4">ยังไม่มีข้อมูลแสดง</p>
                    </div>
                    <button type="button" onclick="fetchSupervisionSummary()" class="w-full bg-white text-purple-600 border border-purple-600 hover:bg-purple-100 font-bold py-2 rounded-lg transition text-sm">
                        <i class="fa-solid fa-sync mr-1"></i> ดึงสรุปข้อมูลล่าสุด
                    </button>
                </div>
            </div>
        </section>

    </div>

    <!-- Script for Logic -->
    <script>
        // Set Current Date
        document.getElementById('currentDate').value = new Date().toLocaleDateString('th-TH');

        // Config Variables
        // Added: Hardcoded URL provided by user
        const HARDCODED_URL = 'https://script.google.com/macros/s/AKfycbzgN5GmkglkzwfrnT1LXWi4pZ0xFOPxtKpmWDJK5W_bzwsxUFU6cLza6Mq5EPKEP9tE/exec';
        
        // Use local storage if available, otherwise fall back to the hardcoded URL
        let REFLECTION_SCRIPT_URL = localStorage.getItem('reflectionScriptUrl') || HARDCODED_URL;
        let SUPERVISION_SCRIPT_URL = localStorage.getItem('supervisionScriptUrl') || HARDCODED_URL;

        // Note: showConfigModal function removed from UI access but kept in logic just in case, 
        // effectively disabled since the button is gone.

        // --- Logic บันทึกหลังสอน ---
        function submitToSheet() {
            const result = document.getElementById('result').value;
            const problems = document.getElementById('problems').value;
            const suggestions = document.getElementById('suggestions').value;

            if(!REFLECTION_SCRIPT_URL) {
                Swal.fire('แจ้งเตือน', 'กรุณาตั้งค่า URL สำหรับบันทึกหลังสอนก่อนครับ', 'warning');
                return;
            }

            Swal.fire({ title: 'กำลังบันทึก...', didOpen: () => Swal.showLoading() });

            const formData = new FormData();
            formData.append('type', 'reflection'); // Tag type
            formData.append('teacher', 'นายสาธิต ศิริวัชน์');
            formData.append('subject', 'ฟิสิกส์ 2 (ว31201)');
            formData.append('date', new Date().toLocaleDateString('th-TH'));
            formData.append('result', result);
            formData.append('problems', problems);
            formData.append('suggestions', suggestions);

            fetch(REFLECTION_SCRIPT_URL, { method: 'POST', body: formData, mode: 'no-cors' })
            .then(() => {
                Swal.fire('สำเร็จ', 'บันทึกหลังสอนเรียบร้อยแล้ว', 'success');
            })
            .catch(err => Swal.fire('Error', 'เกิดข้อผิดพลาดในการส่งข้อมูล', 'error'));
        }

        // --- Logic การนิเทศ (Updated) ---
        function submitSupervision() {
            const name = document.getElementById('supervisorName').value;
            const position = document.getElementById('supervisorPosition').value;
            const level = document.getElementById('supervisorLevel').value;
            const comment = document.getElementById('supervisorComment').value;

            if(!SUPERVISION_SCRIPT_URL) {
                Swal.fire('แจ้งเตือน', 'กรุณาตั้งค่า URL สำหรับการนิเทศก่อนครับ', 'warning');
                return;
            }
            if(!name || !comment) {
                Swal.fire('แจ้งเตือน', 'กรุณากรอกชื่อผู้นิเทศและข้อเสนอแนะ', 'warning');
                return;
            }

            Swal.fire({ title: 'กำลังส่งข้อมูล...', didOpen: () => Swal.showLoading() });

            const formData = new FormData();
            formData.append('type', 'supervision'); // Tag type
            formData.append('supervisor', name);
            formData.append('position', position); // New Field
            formData.append('level', level);       // New Field
            formData.append('comment', comment);
            formData.append('date', new Date().toLocaleDateString('th-TH'));

            fetch(SUPERVISION_SCRIPT_URL, { method: 'POST', body: formData, mode: 'no-cors' })
            .then(() => {
                Swal.fire('สำเร็จ', 'บันทึกผลการนิเทศเรียบร้อยแล้ว', 'success');
                // Clear inputs
                document.getElementById('supervisorName').value = '';
                document.getElementById('supervisorPosition').value = '';
                document.getElementById('supervisorLevel').value = '';
                document.getElementById('supervisorComment').value = '';
            })
            .catch(err => Swal.fire('Error', 'เกิดข้อผิดพลาดในการส่งข้อมูล', 'error'));
        }

        // --- Logic ดึงสรุปผล (Simulated) ---
        function fetchSupervisionSummary() {
            if(!SUPERVISION_SCRIPT_URL) {
                Swal.fire('แจ้งเตือน', 'กรุณาตั้งค่า URL สำหรับการนิเทศก่อน', 'warning');
                return;
            }

            Swal.fire({ title: 'กำลังดึงข้อมูล...', timer: 1000, didOpen: () => Swal.showLoading() }).then(() => {
                // Use fetch to get data from GET endpoint
                fetch(SUPERVISION_SCRIPT_URL)
                    .then(response => response.json())
                    .then(data => {
                        const area = document.getElementById('supervisionSummaryArea');
                        if (data && data.length > 0) {
                            area.innerHTML = ''; // Clear loading/empty text
                            data.forEach(item => {
                                const dateStr = new Date(item.timestamp).toLocaleDateString('th-TH');
                                // Display position and level if available
                                let positionText = item.position ? item.position : '';
                                let levelText = item.level ? item.level : '';
                                let detailText = [positionText, levelText].filter(Boolean).join(' | ');

                                area.innerHTML += `
                                    <div class="bg-white p-2 rounded border border-gray-200 shadow-sm text-xs mb-2">
                                        <p class="font-bold text-purple-700">${item.supervisor}</p>
                                        ${detailText ? `<p class="text-xs text-purple-500 mb-1">${detailText}</p>` : ''}
                                        <p class="text-gray-600">"${item.comment}"</p>
                                        <span class="text-gray-400 text-[10px]">${dateStr}</span>
                                    </div>
                                `;
                            });
                        } else {
                            area.innerHTML = '<p class="text-gray-400 italic text-center mt-4">ยังไม่มีข้อมูลการนิเทศ</p>';
                        }
                    })
                    .catch(err => {
                        console.error('Fetch error:', err);
                        // Fallback purely for demonstration if CORS fails or no data
                        const area = document.getElementById('supervisionSummaryArea');
                        area.innerHTML = '<p class="text-red-400 text-xs text-center mt-4">ไม่สามารถดึงข้อมูลได้ (อาจติดปัญหา CORS หรือยังไม่มีข้อมูล)</p>';
                    });
            });
        }
    </script>
</body>
</html>
